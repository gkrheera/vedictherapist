<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Supabase MVP</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Supabase JS Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
    <style>
        /* Simple spinner for loading states */
        body {
            font-family: 'Inter', sans-serif;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 flex items-center justify-center min-h-screen">

    <div class="w-full max-w-md mx-auto bg-white rounded-xl shadow-md p-8">
        <div id="loading-spinner" class="loader mx-auto my-8 hidden"></div>

        <div id="app-content">
            <!-- Header -->
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-900">Welcome to the MVP</h1>
                <p class="text-gray-500 mt-2">Powered by Supabase & Netlify</p>
            </div>

            <!-- Auth Section: Shown when user is NOT logged in -->
            <div id="auth-view" class="space-y-4">
                <p class="text-center text-gray-600">Please sign in to continue.</p>
                <button id="login-button" class="w-full bg-blue-600 text-white font-semibold py-3 px-4 rounded-lg hover:bg-blue-700 transition duration-300 ease-in-out flex items-center justify-center shadow-sm">
                    <svg class="w-6 h-6 mr-2" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#fff"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l3.66-2.84z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/><path d="M1 1h22v22H1z" fill="none"/></svg>
                    <span>Sign In with Google</span>
                </button>
            </div>

            <!-- Logged In Section: Shown when user IS logged in -->
            <div id="user-view" class="hidden text-center space-y-4">
                <div class="text-center">
                    <p class="text-gray-600">You are logged in as:</p>
                    <p id="user-email" class="font-semibold text-lg bg-gray-100 p-3 rounded-lg"></p>
                </div>
                
                <!-- Location Search Section -->
                <div id="location-search-section" class="pt-4 border-t">
                     <form id="location-form">
                        <label for="location-input" class="block text-left font-medium text-gray-700 mb-1">Search for a location:</label>
                        <input type="text" id="location-input" name="location" class="prokerala-location-input block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="E.g., London, UK" required>
                    </form>
                    <div id="location-result" class="mt-4 text-left text-sm p-3 bg-gray-50 rounded-lg hidden">
                        <p class="font-semibold">Selected Location Data:</p>
                        <span id="coordinates-display"></span><br>
                        <span id="timezone-display"></span>
                    </div>
                </div>

                <button id="logout-button" class="w-full bg-red-500 text-white font-semibold py-3 px-4 rounded-lg hover:bg-red-600 transition duration-300 ease-in-out shadow-sm">
                    Sign Out
                </button>
            </div>

            <!-- Debugging/Log Area -->
            <div id="log-message" class="mt-8 p-3 bg-gray-100 text-gray-600 text-sm rounded-lg h-24 overflow-y-auto">
                <p class="font-semibold mb-2">Log Messages:</p>
                <div id="log-content">Awaiting authentication status...</div>
            </div>
        </div>
    </div>

    <script>
        // --- CONFIGURATION ---
        // IMPORTANT: Replace these with your actual Supabase project URL and Anon Key
        const SUPABASE_URL = 'https://wnmrbharvfaljfnjingq.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndubXJiaGFydmZhbGpmbmppbmdxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3NDMwNDYsImV4cCI6MjA3MzMxOTA0Nn0.AgjPumfwwb0sE9PsCbAz-EpySVTy8CIh1_xMFjD2nt4';
        
        // --- INITIALIZATION ---
        const { createClient } = supabase;
        const _supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

        console.log('Supabase client initialized.');

        // --- DOM ELEMENTS ---
        const loadingSpinner = document.getElementById('loading-spinner');
        const appContent = document.getElementById('app-content');
        const loginButton = document.getElementById('login-button');
        const logoutButton = document.getElementById('logout-button');
        const authView = document.getElementById('auth-view');
        const userView = document.getElementById('user-view');
        const userEmail = document.getElementById('user-email');
        const logContent = document.getElementById('log-content');
        const logMessage = document.getElementById('log-message');
        const locationResult = document.getElementById('location-result');
        const coordinatesDisplay = document.getElementById('coordinates-display');
        const timezoneDisplay = document.getElementById('timezone-display');

        // --- HELPER FUNCTIONS ---
        function writeToLog(message, isError = false) {
            console.log(message);
            const p = document.createElement('p');
            p.textContent = `> ${message}`;
            if (isError) {
                p.style.color = 'red';
            }
            logContent.appendChild(p);
            logMessage.scrollTop = logMessage.scrollHeight; // Auto-scroll
        }

        function showLoading() {
            loadingSpinner.classList.remove('hidden');
            appContent.classList.add('hidden');
        }

        function hideLoading() {
            loadingSpinner.classList.add('hidden');
            appContent.classList.remove('hidden');
        }

        // --- AUTH FUNCTIONS ---
        async function signInWithGoogle() {
            writeToLog('Attempting to sign in with Google...');
            try {
                const { data, error } = await _supabase.auth.signInWithOAuth({
                    provider: 'google',
                });
                if (error) throw error;
                writeToLog('Redirecting to Google for authentication...');
            } catch (error) {
                writeToLog(`Error signing in: ${error.message}`, true);
            }
        }

        async function signOut() {
            writeToLog('Attempting to sign out...');
            try {
                const { error } = await _supabase.auth.signOut();
                if (error) throw error;
                writeToLog('User signed out successfully.');
            } catch (error) {
                writeToLog(`Error signing out: ${error.message}`, true);
            }
        }

        // --- UI UPDATE FUNCTION ---
        function updateUserInterface(session) {
            if (session) {
                // User is logged in
                writeToLog(`User authenticated. Email: ${session.user.email}`);
                userEmail.textContent = session.user.email;
                authView.classList.add('hidden');
                userView.classList.remove('hidden');
            } else {
                // User is logged out
                writeToLog('No active session. User is logged out.');
                userEmail.textContent = '';
                authView.classList.remove('hidden');
                userView.classList.add('hidden');
            }
            hideLoading();
        }

        // --- EVENT LISTENERS ---
        loginButton.addEventListener('click', signInWithGoogle);
        logoutButton.addEventListener('click', signOut);

        // --- AUTH STATE CHANGE LISTENER ---
        _supabase.auth.onAuthStateChange((event, session) => {
            writeToLog(`Auth event: ${event}`);
            console.log('Auth event:', event, 'Session:', session);
            updateUserInterface(session);
        });

        // --- INITIAL CHECK ---
        async function checkInitialSession() {
            showLoading();
            writeToLog('Checking initial user session...');
            const { data: { session } } = await _supabase.auth.getSession();
            updateUserInterface(session);
        }

        // Run the initial check when the script loads.
        checkInitialSession();
        
    </script>
    
    <!-- CODE FOR PROKERALA LOCATION SEARCH STARTS -->
    <script>
      (function () {
          // IMPORTANT: You must get a Client ID from prokerala.com/astrology/api/
          const CLIENT_ID = 'edba7407-3766-4bc1-a618-8ff8eacb034c'; 

          function loadScript(cb) {
              var script = document.createElement('script');
              script.src = 'https://client-api.prokerala.com/static/js/location.min.js';
              script.onload = cb;
              script.async = 1;
              document.head.appendChild(script);
          }
    
          function createInput(name, value) {
              const input = document.createElement('input');
              input.name = name;
              input.type = 'hidden';
              return input;
          }

          function initWidget(input) {
              const form = input.form;
              const inputPrefix = input.dataset.location_input_prefix ? input.dataset.location_input_prefix : '';
              const coordinates = createInput(inputPrefix +'coordinates');
              const timezone = createInput(inputPrefix +'timezone');
              form.appendChild(coordinates);
              form.appendChild(timezone);

              new LocationSearch(input, function (data) {
                  coordinates.value = `${data.latitude},${data.longitude}`;
                  timezone.value = data.timezone;
                  input.setCustomValidity('');

                  // Display the results for the user
                  coordinatesDisplay.textContent = `Coordinates: ${coordinates.value}`;
                  timezoneDisplay.textContent = `Timezone: ${timezone.value}`;
                  locationResult.classList.remove('hidden');
                  writeToLog(`Location selected: ${input.value}`);

              }, {clientId: CLIENT_ID, persistKey: `${inputPrefix}loc`});
    
              input.addEventListener('change', function (e) {
                  input.setCustomValidity('Please select a location from the suggestions list');
                  locationResult.classList.add('hidden'); // Hide result if input is changed manually
              });
          }

          loadScript(function() {
              if (CLIENT_ID === 'YOUR_PROKERALA_CLIENT_ID') {
                  writeToLog('Prokerala Location Search is not configured. Please add your Client ID.', true);
                  return;
              }
              let locationInputs = document.querySelectorAll('.prokerala-location-input');
              Array.from(locationInputs).map(initWidget);
              writeToLog('Prokerala Location Search widget initialized.');
          });
      })();
    </script>
    <!-- CODE FOR LOCATION SEARCH ENDS -->
</body>
</html>



